# Default training configuration for YOLOv8-nano on RDD2022
# Optimized for MPS memory constraints while maximizing accuracy

experiment:
  project: "results"
  name: "yolov8n_rdd2022"
  seed: 42
  exist_ok: false

model:
  weights: "yolov8n.pt"
  imgsz: 416  # Reduced from 448 to 416 to prevent OOM on MPS
  num_classes: 6

optim:
  epochs: 100  # Significantly increased from 60 to 100 for maximum learning
  batch: 1  # Reduced to 1 to prevent OOM; use gradient accumulation if needed
  lr0: 0.01
  lrf: 0.01  # Lower final LR for better fine-tuning in later epochs
  momentum: 0.937
  weight_decay: 0.0005
  warmup_epochs: 3.0
  warmup_momentum: 0.8
  warmup_bias_lr: 0.1
  # Note: More epochs with smaller batch = better convergence without memory issues

augmentation:
  hsv_h: 0.015
  hsv_s: 0.7
  hsv_v: 0.4
  degrees: 10.0
  translate: 0.1
  scale: 0.5
  shear: 2.0
  perspective: 0.0
  flipud: 0.0
  fliplr: 0.5
  mosaic: 0.75  # Reduced from 0.9 to 0.75 to reduce memory usage during augmentation
  mixup: 0.05  # Reduced from 0.1 to 0.05 to reduce memory usage
  copy_paste: 0.0
  close_mosaic: 10  # Disable mosaic later in training for better convergence

hardware:
  # device: "cuda"  # Auto-detected if not set: checks for cuda -> mps -> cpu
  workers: 0  # Set to 0 for MPS to avoid multiprocessing memory issues

validation:
  max_det: 150  # Reduced from 300 to speed up validation and reduce NMS time warnings
  # conf: null  # Use model default confidence threshold (typically 0.25)
  iou: 0.7  # IoU threshold for NMS (default, can be adjusted if needed)

paths:
  data_yaml: "data/yolo/rdd2022.yaml"
  weights_dir: "weights"
